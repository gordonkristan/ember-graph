(function(){window.EmberGraph=window.EG=Em.Namespace.create({VERSION:"0.1.0"}),Ember.libraries&&Ember.libraries.register("Ember Graph",EG.VERSION)})(),function(){Em&&Em.onLoad("Ember.Application",function(a){a.initializer({name:"injectStore",before:"store",initialize:function(a,b){b.inject("controller","store","store:main"),b.inject("route","store","store:main"),b.inject("adapter","store","store:main"),b.inject("serializer","store","store:main")}}),a.initializer({name:"store",initialize:function(a,b){b.register("store:main",b.Store||EG.Store,{singleton:!0}),b.register("adapter:rest",EG.RESTAdapter,{singleton:!0}),b.register("serializer:json",EG.JSONSerializer,{singleton:!0}),b.register("serializer:ember_graph_database",EG.EmberGraphDatabaseSerializer,{singleton:!0}),b.register("type:string",EG.StringType,{singleton:!0}),b.register("type:number",EG.NumberType,{singleton:!0}),b.register("type:boolean",EG.BooleanType,{singleton:!0}),b.register("type:date",EG.DateType,{singleton:!0}),b.register("type:object",EG.ObjectType,{singleton:!0}),b.register("type:array",EG.ArrayType,{singleton:!0});var c=a.lookup("store:main");b.set("store",c)}})})}(),function(){EG.abstractMethod=function(a){return function(){throw new Error("You failed to implement the abstract `"+a+"` method.")}},EG.abstractProperty=function(a){return Em.computed(function(){throw new Error("You failed to override the abstract `"+a+"` property.")}).property()},EG.generateUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})}}(),function(){Em.Set.reopen({withoutAll:function(a){var b=this.copy();return b.removeObjects(a),b}})}(),function(){EG.String={startsWith:function(a,b){return 0===a.indexOf(b)},endsWith:function(a,b){return a.indexOf(b,a.length-b.length)>=0},capitalize:function(a){return a[0].toLocaleUpperCase()+a.substring(1)},decapitalize:function(a){return a[0].toLocaleLowerCase()+a.substring(1)}},(Em.EXTEND_PROTOTYPES===!0||Em.EXTEND_PROTOTYPES.String)&&(String.prototype.startsWith=String.prototype.startsWith||function(a){return EG.String.startsWith(this,a)},String.prototype.endsWith=String.prototype.endsWith||function(a){return EG.String.endsWith(this,a)},String.prototype.capitalize=String.prototype.capitalize||function(){return EG.String.capitalize(this)},String.prototype.decapitalize=String.prototype.decapitalize||function(){return EG.String.decapitalize(this)})}(),function(){var a=["equipment","information","rice","money","species","series","fish","sheep","moose","deer","news"],b=[[/(m)an$/gi,"$1en"],[/(pe)rson$/gi,"$1ople"],[/(child)$/gi,"$1ren"],[/^(ox)$/gi,"$1en"],[/(ax|test)is$/gi,"$1es"],[/(octop|vir)us$/gi,"$1i"],[/(alias|status)$/gi,"$1es"],[/(bu)s$/gi,"$1ses"],[/(buffal|tomat|potat)o$/gi,"$1oes"],[/([ti])um$/gi,"$1a"],[/sis$/gi,"ses"],[/(?:([^f])fe|([lr])f)$/gi,"$1$2ves"],[/(hive)$/gi,"$1s"],[/([^aeiouy]|qu)y$/gi,"$1ies"],[/(x|ch|ss|sh)$/gi,"$1es"],[/(matr|vert|ind)ix|ex$/gi,"$1ices"],[/([m|l])ouse$/gi,"$1ice"],[/(quiz)$/gi,"$1zes"],[/s$/gi,"s"],[/$/gi,"s"]],c=[[/(m)en$/gi,"$1an"],[/(pe)ople$/gi,"$1rson"],[/(child)ren$/gi,"$1"],[/([ti])a$/gi,"$1um"],[/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/gi,"$1$2sis"],[/(hive)s$/gi,"$1"],[/(tive)s$/gi,"$1"],[/(curve)s$/gi,"$1"],[/([lr])ves$/gi,"$1f"],[/([^fo])ves$/gi,"$1fe"],[/([^aeiouy]|qu)ies$/gi,"$1y"],[/(s)eries$/gi,"$1eries"],[/(m)ovies$/gi,"$1ovie"],[/(x|ch|ss|sh)es$/gi,"$1"],[/([m|l])ice$/gi,"$1ouse"],[/(bus)es$/gi,"$1"],[/(o)es$/gi,"$1"],[/(shoe)s$/gi,"$1"],[/(cris|ax|test)es$/gi,"$1is"],[/(octop|vir)i$/gi,"$1us"],[/(alias|status)es$/gi,"$1"],[/^(ox)en/gi,"$1"],[/(vert|ind)ices$/gi,"$1ex"],[/(matr)ices$/gi,"$1ix"],[/(quiz)zes$/gi,"$1"],[/s$/gi,""]],d=function(b,c){if(a.indexOf(b)>=0)return b;for(var d=0;d<c.length;d+=1)if(b.match(c[d][0]))return b.replace(c[d][0],c[d][1]);return b};EG.String.pluralize=function(a){return d(a,b)},EG.String.singularize=function(a){return d(a,c)},(Em.EXTEND_PROTOTYPES===!0||Em.EXTEND_PROTOTYPES.String)&&(String.prototype.pluralize=String.prototype.pluralize||function(){return EG.String.pluralize(this)},String.prototype.singularize=String.prototype.singularize||function(){return EG.String.singularize(this)})}(),function(){EG.Serializer=Em.Object.extend({store:null,serialize:EG.abstractMethod("serialize"),deserialize:EG.abstractMethod("deserialize")})}(),function(){EG.EmberGraphDatabaseSerializer=EG.Serializer.extend({serialize:function(a){var b={};a.get("isNew")||(b.id=a.get("id"));var c=this.get("store");return a.constructor.eachAttribute(function(d,e){var f=c.attributeTypeFor(e.type);b[d]=f.serialize(a.get(d))}),b},deserialize:function(a,b){var c={id:a.id+""},d=this.get("store"),e=d.modelForType(b.recordType);return e.eachAttribute(function(b,f){var g=d.attributeTypeFor(f.type);if(void 0===a[b]){if(f.isRequired){var h={id:a.id,typeKey:e.typeKey,name:b};throw new Error("Attribute was missing: "+JSON.stringify(h))}c[b]=void 0===f.defaultValue?g.get("defaultValue"):f.defaultValue}else c[b]=g.deserialize(a[b])}),c}})}(),function(){var a=Ember.ArrayPolyfills.map,b=Ember.ArrayPolyfills.filter,c=Ember.ArrayPolyfills.forEach,d=function(a){return"[object Array]"===Object.prototype.toString.call(a)},e=function(a){return null===a?null:a+""};EG.JSONSerializer=EG.Serializer.extend({serialize:function(a,b){switch(b.requestType){case"updateRecord":return this.serializeDelta(a);case"createRecord":var c={};return c[EG.String.pluralize(a.typeKey)]=[this.serializeRecord(a)],c;default:throw new Error("Invalid request type for JSON serializer.")}},serializeRecord:function(a){var b={links:{}};return a.constructor.eachAttribute(function(c){var d=this.serializeAttribute(a,c);d&&(b[d.name]=d.value)},this),a.constructor.eachRelationship(function(c){var d=this.serializeRelationship(a,c);d&&(b.links[d.name]=d.value)},this),b},serializeAttribute:function(a,b){var c=a.constructor.metaForAttribute(b),d=this.get("store").attributeTypeFor(c.type);return{name:b,value:d.serialize(a.get(b))}},serializeRelationship:function(a,c){var d=a.constructor.metaForRelationship(c),e=a.get("_"+c);return d.kind===EG.Model.HAS_ONE_KEY?(null===e||EG.Model.isTemporaryId(e))&&(e=null):d.kind===EG.Model.HAS_MANY_KEY&&(e=b.call(e,function(a){return!EG.Model.isTemporaryId(a)})),{name:c,value:e}},serializeDelta:function(a){var b=[];return b=b.concat(this.serializeAttributeDelta(a)),b=b.concat(this.serializeRelationshipDelta(a))},serializeAttributeDelta:function(b){var c=b.changedAttributes(),d=this.get("store");return a.call(Em.keys(c),function(a){var e=b.constructor.metaForAttribute(a),f=d.attributeTypeFor(e.type),g=f.serialize(c[a][1]);return{op:"replace",path:"/"+a,value:g}})},serializeRelationshipDelta:function(a){var b=[],d=a.changedRelationships();return c.call(Em.keys(d),function(c){var e=d[c],f=a.constructor.metaForRelationship(c);if(f.kind===EG.Model.HAS_ONE_KEY)b.push({op:"replace",path:"/links/"+c,value:e[1]});else if(f.kind===EG.Model.HAS_MANY_KEY){var g=new Em.Set(e[1]).withoutAll(e[0]),h=new Em.Set(e[0]).withoutAll(e[1]);g.forEach(function(a){b.push({op:"add",path:"/links/"+c+"/-",value:a})}),h.forEach(function(a){b.push({op:"remove",path:"/links/"+c+"/"+a})})}}),b},deserialize:function(b,d){b=b||{},d=d||{};var e=this.get("store"),f=this.transformPayload(b,d);return c.call(Em.keys(f),function(b){if("meta"!==b){var c=e.modelForType(b);f[b]=a.call(f[b],function(a){return this.deserializeRecord(c,a)},this)}},this),f},transformPayload:function(b,d){if(!b||0===Em.keys(b).length)return{};var f={meta:{serverMeta:b.meta||{}}};return delete b.meta,"findQuery"===d.requestType?f.meta.queryIds=a.call(b[EG.String.pluralize(d.recordType)],function(a){return e(a.id)}):"createRecord"===d.requestType&&(f.meta.newId=e(b[EG.String.pluralize(d.recordType)][0].id)),c.call(Em.keys(b),function(a){"linked"!==a&&"meta"!==a&&(f[EG.String.singularize(a)]=b[a],delete b[a])}),c.call(Em.keys(b.linked||{}),function(a){f[EG.String.singularize(a)]=b.linked[a]}),f},deserializeRecord:function(a,b){var c={id:e(b.id)};switch(Em.typeOf(b.id)){case"string":case"number":c.id=e(b.id);break;case"undefined":throw new Error("Your JSON is missing an ID: "+JSON.stringify(b));default:throw new Error("Your JSON has an invalid ID: "+JSON.stringify(b))}return a.eachAttribute(function(d){var e=this.deserializeAttribute(a,b,d);e&&(c[e.name]=e.value)},this),b.links=b.links||{},a.eachRelationship(function(d){var e=this.deserializeRelationship(a,b,d);e&&(c[e.name]=e.value)},this),c},deserializeAttribute:function(a,b,c){var d,e=a.metaForAttribute(c),f=this.get("store").attributeTypeFor(e.type),g=b[c];if(void 0===g){if(e.isRequired)throw d={id:b.id,typeKey:a.typeKey,name:c},new Error("Attribute was missing: "+JSON.stringify(d));return{name:c,value:void 0===e.defaultValue?f.get("defaultValue"):e.defaultValue}}return{name:c,value:f.deserialize(g)}},deserializeRelationship:function(b,c,f){var g,h=b.metaForRelationship(f),i=c.links[f];if(void 0===i){if(h.isRequired)throw g={id:c.id,typeKey:b.typeKey,name:f},new Error("Relationship was missing: "+JSON.stringify(g));return{name:f,value:i}}if(h.kind!==EG.Model.HAS_ONE_KEY){if(h.kind===EG.Model.HAS_MANY_KEY){if(!d(i))throw g={id:c.id,typeKey:b.typeKey,name:f,value:i},new Error("Invalid hasMany relationship value: "+JSON.stringify(g));return{name:f,value:a.call(i,function(a){switch(Em.typeOf(a)){case"string":case"number":return e(a);default:case"null":throw g={id:c.id,typeKey:b.typeKey,name:f,value:i},new Error("Invalid hasMany relationship value: "+JSON.stringify(g))}})}}return null}switch(Em.typeOf(i)){case"null":case"string":case"number":return{name:f,value:e(i)};default:throw g={id:c.id,typeKey:b.typeKey,name:f,value:i},new Error("Invalid hasOne relationship value: "+JSON.stringify(g))}}})}(),function(){EG.Adapter=Em.Object.extend({store:null,defaultSerializer:"json",serializer:Em.computed(function(){var a=this.get("container"),b=a.lookup("serializer:application")||a.lookup("serializer:"+this.get("defaultSerializer"));return b}).property().readOnly(),createRecord:EG.abstractMethod("createRecord"),findRecord:EG.abstractMethod("findRecord"),findMany:EG.abstractMethod("findMany"),findAll:EG.abstractMethod("findAll"),findQuery:EG.abstractMethod("findQuery"),updateRecord:EG.abstractMethod("updateRecord"),deleteRecord:EG.abstractMethod("deleteRecord"),serialize:function(a,b){return this.get("serializer").serialize(a,b)},deserialize:function(a,b){return this.get("serializer").deserialize(a,b)}})}(),function(){var a=Em.RSVP.Promise;EG.EmberGraphDatabaseAdapter=EG.Adapter.extend({database:EG.abstractProperty("database"),serializer:Em.computed(function(){return this.get("container").lookup("serializer:ember_graph_database")}).property().readOnly(),createRecord:function(b){try{var c=this.serverCreateRecord(b),d={meta:{newId:c.id}};return d[b.typeKey]=[c],a.resolve(d)}catch(e){return a.reject()}},findRecord:function(b,c){try{var d=this.retrieveRecord(b,c),e=this.deserialize(d,{recordType:b}),f={};return f[b]=[e],a.resolve(f)}catch(g){return a.reject()}},findMany:function(b,c){try{var d=map.call(c,function(a){return this.retrieveRecord(b,a)},this),e=map.call(d,function(a){return this.deserialize(a,{recordType:b})},this),f={};return f[b]=e,a.resolve(f)}catch(g){return a.reject()}},findAll:function(b){try{var c=this.retrieveRecords(b),d=map.call(c,function(a){return this.deserialize(a,{recordType:b})},this),e={};return e[b]=d,a.resolve(e)}catch(f){return a.reject()}},findQuery:function(b,c){try{var d=this.retrieveRecords(b,c),e=map.call(d,function(a){return this.deserialize(a,{recordType:b})},this),f={};return f[b]=e,a.resolve(f)}catch(g){return a.reject()}},updateRecord:function(b){try{var c=this.serverUpdateRecord(b),d={};return d[b.typeKey]=[c],a.resolve(d)}catch(e){return a.reject()}},deleteRecord:function(b){try{return this.serverDeleteRecord(b),a.resolve()}catch(c){return a.reject()}}})}(),function(){var a=Em.RSVP.Promise,b=Em.ArrayPolyfills.forEach;EG.RESTAdapter=EG.Adapter.extend({createRecord:function(a){var b=this,c=this.buildUrl(a.typeKey),d=this.serialize(a,{requestType:"createRecord"});return this.ajax(c,"POST",d).then(function(c){return b.deserialize(c,{requestType:"createRecord",recordType:a.typeKey})})},findRecord:function(a,b){var c=this,d=this.buildUrl(a,b);return this.ajax(d,"GET").then(function(d){return c.deserialize(d,{requestType:"findRecord",recordType:a,id:b})})},findMany:function(a,b){var c=this,d=this.buildUrl(a,b.join(","));return this.ajax(d,"GET").then(function(d){return c.deserialize(d,{requestType:"findMany",recordType:a,ids:b})})},findAll:function(a){var b=this,c=this.buildUrl(a);return this.ajax(c,"GET").then(function(c){return b.deserialize(c,{requestType:"findAll",recordType:a})})},findQuery:function(a,c){var d=this,e={};b.call(Em.keys(c),function(a){e[a]=""+c[a]});var f=this.buildUrl(a,null,e);return this.ajax(f,"GET").then(function(b){return d.deserialize(b,{requestType:"findQuery",recordType:a,query:c})})},updateRecord:function(b){var c=this,d=this.buildUrl(b.typeKey,b.get("id")),e=this.serialize(b,{requestType:"updateRecord"});return e.length<=0?a.resolve():this.ajax(d,"PATCH",e).then(function(a){return c.deserialize(a,{requestType:"updateRecord",recordType:b.typeKey})})},deleteRecord:function(a){var b=this,c=this.buildUrl(a.typeKey,a.get("id"));return this.ajax(c,"DELETE").then(function(c){var d={requestType:"deleteRecord",recordType:a.typeKey};return b.deserialize(c,d)})},buildUrl:function(a,c,d){var e=this.get("prefix")+"/"+EG.String.pluralize(a);return c&&(e+="/"+c),d&&b.call(Em.keys(d),function(a,b){e+=(0===b?"?":"&")+a+"="+encodeURIComponent(d[a])}),e},prefix:Em.computed(function(){return""}).property(),ajax:function(b,c,d){var e=this.headers(b,c,d);return new a(function(a,f){$.ajax({cache:!1,contentType:"application/json",data:void 0===d?void 0:"string"===Em.typeOf(d)?d:JSON.stringify(d),headers:e,processData:!1,type:c,url:b,error:function(a,b,c){Em.run(null,f,c)},success:function(b){Em.run(null,a,b)}})})},headers:function(){return{}}})}(),function(){EG.Store=Em.Object.extend({cacheTimeout:1/0,_records:{},adapterCache:{},init:function(){this._super(),this.set("_records",{}),this.set("_types",{}),this.set("_relationships",{}),this.set("_queuedRelationships",{}),this.set("adapterCache",{})},_getRecord:function(a,b){var c=this.get("_records");return c[a]=c[a]||{},c[a][b]},_setRecord:function(a,b){var c=this.get("_records");c[a]=c[a]||{},c[a][b.get("id")]={record:b,timestamp:(new Date).getTime()}},_deleteRecord:function(a,b){var c=this.get("_records");c[a]=c[a]||{},delete c[a][b]},modelForType:function(a){this._modelCache=this._modelCache||{};var b=this.get("container").lookupFactory("model:"+a);return this._modelCache[a]||(this._modelCache[a]=b,b.reopen({typeKey:a}),b.reopenClass({typeKey:a})),b},createRecord:function(a,b){b=b||{};var c=this.modelForType(a)._create();return c.set("store",this),c.set("id",EG.Model.temporaryIdPrefix+EG.generateUUID()),this._setRecord(a,c),c.loadData(b),c},_loadRecord:function(a,b){var c=this.modelForType(a)._create();return c.set("store",this),c.set("id",b.id),this._setRecord(a,c),this._hasQueuedRelationships(a,b.id)&&this._connectQueuedRelationships(c),c.loadData(b),c},cachedRecordsFor:function(a){var b=this.get("_records."+a)||{},c=(new Date).getTime()-this.get("cacheTimeout");return Em.keys(b).map(function(a){var d=b[a];return d.timestamp>=c?d.record:void 0})},find:function(a,b){if(arguments.length>1&&!b)throw new Ember.Error("A bad `find` call was made to the store.");switch(Em.typeOf(b)){case"string":return this._findSingle(a,b);case"array":return this._findMany(a,b);case"object":return this._findQuery(a,b);case"undefined":return this._findAll(a);default:throw new Ember.Error("A bad `find` call was made to the store.")}},getRecord:function(a,b){var c=this._getRecord(a,b),d=(new Date).getTime()-this.get("cacheTimeout");return c&&c.record?c.timestamp>=d?c.record:null:null},_findSingle:function(a,b){var c,d=this.getRecord(a,b);return c=d?Em.RSVP.Promise.resolve(d):this.adapterFor(a).findRecord(a,b).then(function(c){return this.extractPayload(c),this.getRecord(a,b)}.bind(this)),EG.ModelPromiseObject.create({id:b,promise:c})},_findMany:function(a,b){b=b||[];var c=new Em.Set(b);b.forEach(function(b){null!==this.getRecord(a,b)&&c.removeObject(b)},this);var d;return d=0===c.length?Em.RSVP.Promise.resolve(b.map(function(b){return this.getRecord(a,b)},this)):this.adapterFor(a).findMany(a,c.toArray()).then(function(c){return this.extractPayload(c),b.map(function(b){return this.getRecord(a,b)},this).toArray()}.bind(this)),EG.PromiseArray.create({promise:d})},_findAll:function(a){var b=this.adapterFor(a).findAll(a).then(function(b){return this.extractPayload(b),this.cachedRecordsFor(a)}.bind(this));return EG.PromiseArray.create({promise:b})},_findQuery:function(a,b){var c=this.adapterFor(a).findQuery(a,b).then(function(b){var c=b.meta.ids;return this.extractPayload(b),c.map(function(b){return this.getRecord(a,b)},this)}.bind(this));return EG.PromiseArray.create({promise:c})},hasRecord:function(a,b){return null!==this.getRecord(a,b)},saveRecord:function(a){var b=a.typeKey,c=a.get("isNew"),d=a.get("id");return c?this.adapterFor(a.typeKey).createRecord(a).then(function(c){return a.set("id",c.meta.newId),this._deleteRecord(b,d),this._setRecord(b,a),this.extractPayload(c),a}.bind(this)):this.adapterFor(a.typeKey).updateRecord(a).then(function(b){return this.extractPayload(b),a}.bind(this))},deleteRecord:function(a){if(a.get("isCreating"))return Em.RSVP.reject("Can't delete a record before it's created.");var b=a.typeKey,c=a.get("id");return a.get("isNew")?(this._deleteRelationshipsForRecord(b,c),this._deleteRecord(b,c),a.set("store",null),Em.RSVP.resolve()):this.adapterFor(a.typeKey).deleteRecord(a).then(function(d){this._deleteRelationshipsForRecord(b,c),this.extractPayload(d),this._deleteRecord(b,c),a.set("store",null)}.bind(this))},reloadRecord:function(a){return this.adapterFor(a.typeKey).findRecord(a.typeKey,a.get("id")).then(function(b){return this.extractPayload(b),a}.bind(this))},extractPayload:function(a){a=a||{},Em.changeProperties(function(){var b=this.get("reloadDirty");Em.keys(a).forEach(function(c){if("meta"!==c){{this.modelForType(c)}a[c].forEach(function(a){var d=this.getRecord(c,a.id);d?(!d.get("isDirty")||b)&&d.loadData(a):this._loadRecord(c,a)},this)}},this)},this)},attributeTypeFor:function(a){var b=this.get("container").lookup("type:"+a);return b},adapterFor:function(a){var b=this.get("adapterCache");if(!b[a]){var c=this.get("container");b[a]=c.lookup("adapter:"+a)||c.lookup("adapter:application")||c.lookup("adapter:rest")}return b[a]}})}(),function(){EG.Store.reopen({reloadDirty:!0,sideWithClientOnConflict:!0,overwriteClientAttributes:!1,_relationships:{},_queuedRelationships:null,_hasQueuedRelationships:function(a,b){var c,d=this.get("_queuedRelationships");for(c in d)if(d.hasOwnProperty(c)&&d[c].get("type2")===a&&d[c].get("object2")===b)return!0;return!1},_connectQueuedRelationships:function(a){var b=this.get("_queuedRelationships"),c=this._queuedRelationshipsFor(a.typeKey,a.get("id"));c.forEach(function(c){a._connectRelationship(c),c.set("object2",a),delete b[c.get("id")]}),this.notifyPropertyChange("_queuedRelationships")},_queuedRelationshipsFor:function(a,b){var c,d=[],e=this.get("_queuedRelationships");for(var f in e)e.hasOwnProperty(f)&&(c=e[f],c.get("type2")===a&&c.get("object2")===b&&d.push(c));return d},_createRelationship:function(a,b,c,d,e,f,g){var h=this.getRecord(a,c),i=this.getRecord(d,f);if(null!==h||null!==i){if(null===h){var j=h;h=i,i=j,j=c,c=f,f=c,j=b,b=e,e=j}if(null!==b&&!h._isLinkedTo(b,f)){var k=EG.Relationship.create({object1:h,relationship1:b,object2:null===i?f:i,relationship2:e,state:g});this.get("_relationships")[k.get("id")]=k,h._connectRelationship(k),null!==i?i._connectRelationship(k):(this.set("_queuedRelationships."+k.get("id"),k),this.notifyPropertyChange("_queuedRelationships"))}}},_deleteRelationship:function(a){var b=this.get("_relationships")[a];if(!Em.isNone(b)){var c=b.get("object1"),d=b.get("object2");c._disconnectRelationship(b),EG.Model.detectInstance(d)?d._disconnectRelationship(b):(delete this.get("_queuedRelationships")[a],this.notifyPropertyChange("_queuedRelationships")),delete this.get("_relationships")[a]}},_changeRelationshipState:function(a,b){var c=this.get("_relationships")[a];if(!Em.isNone(c)&&c.get("state")!==b){var d=c.get("object1"),e=c.get("object2"),f=EG.Relationship.stateToHash(c.get("state")),g=EG.Relationship.stateToHash(b);c.set("state",b),d.set(g+"."+a,d.get(f+"."+a)),delete d.get(f)[a],d.notifyPropertyChange(f),d.notifyPropertyChange(g),EG.Model.detectInstance(e)&&(e.set(g+"."+a,e.get(f+"."+a)),delete e.get(f)[a],e.notifyPropertyChange(f),e.notifyPropertyChange(g))}},_relationshipsForRecord:function(a,b,c){var d,e,f,g=[],h=this.get("_relationships");for(d in h)if(h.hasOwnProperty(d)){if(e=h[d],e.get("type1")===a&&e.get("id")===c&&e.get("relationship1")===b){g.push(e);continue}if(e.get("type2")===a&&e.get("relationship2")===b)if(f=e.get("object2"),"string"===Em.typeOf(f)){if(f===c){g.push(e);continue}}else if(f.get("id")===c){g.push(e);continue}}return g},_deleteRelationshipsForRecord:function(a,b){var c,d=this.get("_relationships");for(var e in d)d.hasOwnProperty(e)&&(c=d[e],c.isConnectedTo(a,b)&&this._deleteRelationship(Em.get(c,"id")))}})}(),function(){EG.PromiseObject=Em.ObjectProxy.extend(Em.PromiseProxyMixin),EG.PromiseArray=Em.ArrayProxy.extend(Em.PromiseProxyMixin),EG.ModelPromiseObject=EG.PromiseObject.extend({__modelId:null,id:function(a,b){var c=this.get("content");return arguments.length>1&&(c&&c.set?c.set("id",b):this.set("__modelId",b)),c&&c.get?c.get("id"):this.get("__modelId")}.property("__modelId","content.id")})}(),function(){var a="new",b="saved",c="deleted";EG.Relationship=Em.Object.extend({id:null,state:function(){var d=a;return function(e,f){if(arguments.length>1){if(f!==a&&f!==b&&f!==c)throw new Error("'"+f+"' is an invalid relationship state.");d=f}return d}}(),object1:null,relationship1:null,type1:null,object2:null,relationship2:null,type2:null,oneWay:Em.computed(function(){return null===this.get("relationship2")}).property("relationship2"),init:function(){this.set("id",Em.generateGuid(null,"relationship"))},isNew:function(){return this.get("state")===a},isSaved:function(){return this.get("state")===b},isDeleted:function(){return this.get("state")===c},otherId:function(a){if(this.get("object1")===a){var b=this.get("object2");return"string"===Em.typeOf(b)?b:b.get("id")}return this.get("object1.id")},otherRecord:function(a){var b=this.get("object1");if(b===a){var c=this.get("object2");if("string"===Em.typeOf(c)){var d=b.constructor.metaForRelationship(this.get("relationship1")).relatedType;return b.get("store").getRecord(d,c)}return c}return b},relationshipName:function(a){return this.get("object1")===a?this.get("relationship1"):this.get("object2")===a?this.get("relationship2"):void 0},isConnectedTo:function(a,b){if(this.get("type1")===a&&this.get("object1.id")===b)return!0;if(this.get("type2")===a){var c=this.get("object2");return"string"===Em.typeOf(c)?c===b:Em.get(c,"id")===b}return!1}}),EG.Relationship.reopenClass({NEW_STATE:a,SAVED_STATE:b,DELETED_STATE:c,create:function(a){var b=this._super();return b.setProperties(a),b.set("type1",a.object1.typeKey),EG.Model.detectInstance(a.object2)?b.set("type2",a.object2.typeKey):b.set("type2",a.object1.constructor.metaForRelationship(a.relationship1).relatedType),b},stateToHash:function(d){switch(d){case a:return"_clientRelationships";case b:return"_serverRelationships";case c:return"_deletedRelationships";default:return""}}})}(),function(){EG.AttributeType=Em.Object.extend({defaultValue:null,serialize:function(a){return a},deserialize:function(a){return a},isEqual:function(a,b){return a===b}})}(),function(){EG.ArrayType=EG.AttributeType.extend({serialize:function(){return Em.isNone(obj)?null:(obj=obj.toArray?obj.toArray():obj,Em.isArray(obj)?obj:null)},deserialize:function(a){return Em.isArray(a)?a:null},isEqual:function(a,b){return Em.isArray(a)&&Em.isArray(b)?0===Em.compare(a.toArray(),b.toArray()):!1}})}(),function(){EG.BooleanType=EG.AttributeType.extend({defaultValue:!1,serialize:function(a){return this.coerceToBoolean(a)},deserialize:function(a){return this.coerceToBoolean(a)},coerceToBoolean:function(a){return"boolean"===Em.typeOf(a)&&1==a?!0:"string"===Em.typeOf(a)&&"true"==a?!0:!1}})}(),function(){EG.DateType=EG.AttributeType.extend({serialize:function(a){switch(Em.typeOf(a)){case"date":return a.getTime();case"number":return a;case"string":return new Date(a).getTime();default:return null}},deserialize:function(a){switch(Em.typeOf(a)){case"number":case"string":return new Date(a);default:return null}},isEqual:function(a,b){var c=null===a,d=null===b;return c&&d?!0:c&&!d||!c&&d?!1:new Date(a).getTime()===new Date(b).getTime()}})}(),function(){EG.EnumType=EG.AttributeType.extend({defaultValue:Em.computed(function(){throw new Error("You must override the `defaultValue` in an enumeration type.")}).property(),values:[],valueSet:Em.computed(function(){return new Em.Set(this.get("values").map(function(a){return a.toLocaleLowerCase()}))}).property("values"),isValidValue:function(a){return this.get("valueSet").contains(a.toLowerCase())},serialize:function(a){if(a+="",this.isValidValue(a))return a;var b=this.get("defaultValue");if(this.isValidValue(b))return b;throw new Error("The default value you provided isn't a valid value.")},deserialize:Em.aliasMethod("serialize"),isEqual:function(a,b){return"string"!==Em.typeOf(a)||"string"!==Em.typeOf(b)?!1:(a+"").toLocaleLowerCase()===(b+"").toLocaleLowerCase()}})}(),function(){EG.NumberType=EG.AttributeType.extend({defaultValue:0,serialize:function(a){return this.coerceToNumber(a)},deserialize:function(a){return this.coerceToNumber(a)},coerceToNumber:function(a){if(this.isValidNumber(a))return Number(a).valueOf();if("string"===Em.typeOf(a)){var b=Number(a).valueOf();if(this.isValidNumber(b))return b}return 0},isValidNumber:function(a){return"number"===Em.typeOf(a)&&!isNaN(a)&&isFinite(a)}})}(),function(){EG.ObjectType=EG.AttributeType.extend({serialize:function(a){if(!this.isObject(a))return null;try{return JSON.stringify(a),a}catch(b){return null}},deserialize:function(a){return this.isObject(a)?a:null},isEqual:function(a,b){return this.isObject(a)&&this.isObject(b)?this.deepCompare(a,b):!1},isObject:function(a){return!Em.isNone(a)&&"object"===Em.typeOf(a)&&a.constructor===Object},deepCompare:function(a,b){if(this.isObject(a)&&this.isObject(b)){if(!new Em.Set(Em.keys(a)).isEqual(new Em.Set(Em.keys(b))))return!1;for(var c=Em.keys(a),d=0;d<c.length;d+=1)if(!this.deepCompare(a[c[d]],b[c[d]]))return!1;return!0}return Em.isArray(a)&&Em.isArray(b)?0===Em.compare(a,b):a===b}})}(),function(){EG.StringType=EG.AttributeType.extend({serialize:function(a){return null===a?null:""+a},deserialize:function(a){return null===a?null:""+a}})}(),function(){EG.Model=Em.Object.extend(Em.Evented,{typeKey:null,_id:null,id:Em.computed(function(a,b){var c=this.get("_id");if(arguments.length>1){var d=this.constructor.temporaryIdPrefix;if(null===c)return this.set("_id",b),b;if(EG.String.startsWith(c,d)&&!EG.String.startsWith(b,d))return this.set("_id",b),b;throw new Error("Cannot change the 'id' property of a model.")}return c}).property("_id"),store:null,loadData:function(a){a=a||{},this._loadAttributes(a),this._loadRelationships(a)},save:function(){var a=this,b=null;return b=this.get("isNew")?"isCreating":"isSaving",this.set(b,!0),this.get("store").saveRecord(this).finally(function(){a.set(b,!1)})},reload:function(){var a=this;return this.set("isReloading",!0),this.get("store").reloadRecord(this).finally(function(){a.set("isReloading",!1)})},destroy:function(){var a=this;return this.set("isDeleting",!0),this.get("store").deleteRecord(this).then(function(){a.set("isDeleted",!0),a.set("store",null)}).finally(function(){a.set("isDeleting",!1)})},isEqual:function(a){return a?this.typeKey===Em.get(a,"typeKey")&&this.get("id")===Em.get(a,"id"):void 0},rollback:function(){this.rollbackAttributes(),this.rollbackRelationships()}}),EG.Model.reopenClass({temporaryIdPrefix:"EG_TEMP_ID_",isTemporaryId:function(a){return EG.String.startsWith(a,this.temporaryIdPrefix)},create:function(){},_create:EG.Model.create,extend:function(){var a=Array.prototype.slice.call(arguments,0),b=a.pop()||{},c={},d={};b instanceof Em.Mixin||Em.keys(b).forEach(function(a){var e=b[a];b[a]&&(b[a].isRelationship?(d[a]=e,delete b[a]):b[a].isAttribute&&(c[a]=e,delete b[a]))}),a.push(b);var e=this._super.apply(this,a);return e._declareAttributes(c),e._declareRelationships(d),e},isEqual:function(a,b){return Em.isNone(a)||Em.isNone(b)?!1:this.detectInstance(a)?a.isEqual(b):this.detectInstance(b)?b.isEqual(a):this.detectInstance(Em.get(a,"content"))?Em.get(a,"content").isEqual(b):this.detectInstance(Em.get(b,"content"))?Em.get(b,"content").isEqual(a):!1}})}(),function(){EG.Model.reopen({isDeleting:!1,isDeleted:!1,isSaving:!1,isReloading:!1,isLoaded:Em.computed(function(){return null!==this.get("store")}).property("store"),isDirty:Em.computed.or("_areAttributesDirty","_areRelationshipsDirty"),isCreating:!1,isNew:Em.computed(function(){return EG.String.startsWith(this.get("_id"),this.constructor.temporaryIdPrefix)}).property("_id"),isInTransit:Em.computed.or("isSaving","isDeleting","isCreating","isReloading")})}(),function(){var a=(new Em.Set(["id","type","content"]),function(a,b){var c={isAttribute:!0,type:b.type,isRequired:!b.hasOwnProperty("defaultValue"),defaultValue:b.defaultValue,readOnly:b.readOnly===!0,isEqual:b.isEqual},d=Em.computed(function(a,b){var c=this.constructor.metaForAttribute(a),d=this.get("_serverAttributes."+a),e=this.get("_clientAttributes."+a),f=void 0===e?d:e;if(void 0!==b){var g=c.isEqual||this.get("store").attributeTypeFor(c.type).isEqual;return g(d,b)?delete this.get("_clientAttributes")[a]:this.set("_clientAttributes."+a,b),this.notifyPropertyChange("_clientAttributes"),b}return f}).property("_clientAttributes."+a,"_serverAttributes."+a).meta(c);return b.readOnly?d.readOnly():d});EG.Model.reopenClass({_declareAttributes:function(b){var c={};Em.keys(b).forEach(function(d){c[d]=a(d,b[d].options)}),this.reopen(c)},attributes:Em.computed(function(){var a=new Em.Set;return this.eachComputedProperty(function(b,c){c.isAttribute&&a.addObject(b)}),a}).property(),metaForAttribute:Em.aliasMethod("metaForProperty"),isAttribute:function(a){return Em.get(this,"attributes").contains(a)},eachAttribute:function(a,b){this.eachComputedProperty(function(c,d){d.isAttribute&&a.call(b,c,d)})}}),EG.Model.reopen({_serverAttributes:null,_clientAttributes:null,_initializeAttributes:function(){this.set("_serverAttributes",Em.Object.create()),this.set("_clientAttributes",Em.Object.create())}.on("init"),_areAttributesDirty:Em.computed(function(){return Em.keys(this.get("_clientAttributes")||{}).length>0}).property("_clientAttributes"),changedAttributes:function(){var a={},b=this.get("store");return this.constructor.eachAttribute(function(c,d){var e=this.get("_serverAttributes."+c),f=this.get("_clientAttributes."+c),g=b.attributeTypeFor(d.type),h=d.isEqual||g.isEqual;void 0===f||h(e,f)||(a[c]=[e,f])},this),a},rollbackAttributes:function(){this.set("_clientAttributes",Em.Object.create())},_loadAttributes:function(a){this.constructor.eachAttribute(function(b,c){var d=a.hasOwnProperty(b)?a[b]:c.defaultValue;this.set("_serverAttributes."+b,d),this._synchronizeAttribute(b)},this)},_synchronizeAttribute:function(a){var b=this.get("_serverAttributes."+a),c=this.get("_clientAttributes."+a),d=this.constructor.metaForAttribute(a),e=d.isEqual||this.get("store").attributeTypeFor(d.type).isEqual;e(b,c)&&(delete this.get("_clientAttributes")[a],this.notifyPropertyChange("_clientAttributes"))}})}(),function(){var a=EG.Model.HAS_ONE_KEY="hasOne",b=EG.Model.HAS_MANY_KEY="hasMany",c=EG.Relationship.NEW_STATE,d=EG.Relationship.SAVED_STATE,e=EG.Relationship.DELETED_STATE,f=(new Em.Set(["id","type","content"]),function(a,c,d){var e={isRelationship:!1,kind:c,isRequired:d.hasOwnProperty("defaultValue")?!1:d.isRequired!==!1,defaultValue:d.defaultValue||(c===b?[]:null),relatedType:d.relatedType,inverse:d.inverse,readOnly:d.readOnly===!0};
return c===b?Em.computed(function(a){return this._hasManyValue(a.substring(1))}).property("_serverRelationships."+a,"_clientRelationships."+a).meta(e).readOnly():Em.computed(function(a){return this._hasOneValue(a.substring(1))}).property("_serverRelationships."+a,"_clientRelationships."+a).meta(e).readOnly()});EG.Model.reopenClass({_declareRelationships:function(a){var c={};Em.keys(a).forEach(function(d){var e,g=a[d].kind,h=a[d].options,i=h.relatedType;e=g===b?function(){return this.get("store").find(i,this.get("_"+d).toArray())}:function(){var a=this.get("_"+d);return null===a?null:this.get("store").find(i,a)},c["_"+d]=f(d,g,h);var j=Em.copy(c["_"+d].meta(),!0);j.isRelationship=!0,c[d]=Em.computed(e).property("_"+d).meta(j).readOnly()}),this.reopen(c)},relationships:Em.computed(function(){var a=new Em.Set;return this.eachComputedProperty(function(b,c){c.isRelationship&&a.addObject(b)}),a}).property(),isRelationship:function(a){return Em.get(this,"relationships").contains(a)},metaForRelationship:Em.aliasMethod("metaForProperty"),relationshipKind:function(a){return this.metaForRelationship(a).kind},eachRelationship:function(a,b){this.eachComputedProperty(function(c,d){d.isRelationship&&a.call(b,c,d)})}}),EG.Model.reopen({_serverRelationships:null,_deletedRelationships:null,_clientRelationships:null,_initializeRelationships:function(){this.set("_serverRelationships",Em.Object.create()),this.set("_clientRelationships",Em.Object.create()),this.set("_deletedRelationships",Em.Object.create())}.on("init"),_hasOneValue:function(a,b){var c,d=this.get("_serverRelationships");for(c in d)if(d.hasOwnProperty(c)&&d[c].relationshipName(this)===a)return d[c].otherId(this);var e=this.get((b?"_deleted":"_client")+"Relationships");for(c in e)if(e.hasOwnProperty(c)&&e[c].relationshipName(this)===a)return e[c].otherId(this);return null},_hasManyValue:function(a,b){var c,d=[],e=this.get("_serverRelationships");for(c in e)e.hasOwnProperty(c)&&e[c].relationshipName(this)===a&&d.push(e[c].otherId(this));var f=this.get((b?"_deleted":"_client")+"Relationships");for(c in f)f.hasOwnProperty(c)&&f[c].relationshipName(this)===a&&d.push(f[c].otherId(this));return new Em.Set(d)},_areRelationshipsDirty:Em.computed(function(){var a=Em.keys(this.get("_clientRelationships")).length>0,b=Em.keys(this.get("_deletedRelationships")).length>0;return a||b}).property("_clientRelationships","_deletedRelationships"),_getAllRelationships:function(){var a,b=[],c=this.get("_serverRelationships");for(a in c)c.hasOwnProperty(a)&&b.push(c[a]);var d=this.get("_clientRelationships");for(a in d)d.hasOwnProperty(a)&&b.push(d[a]);var e=this.get("_deletedRelationships");for(a in e)e.hasOwnProperty(a)&&b.push(e[a]);return b},_loadRelationships:function(a){var f=this.get("store"),g=f.get("sideWithClientOnConflict");this.constructor.eachRelationship(function(h,i){if(i.isRequired&&!a.hasOwnProperty(h))throw new Error("You left out the required '"+h+"' relationship.");var j=a[h]||i.defaultValue;if(i.kind===b)j=j.map(function(a){if("string"===Em.typeOf(a))return a;if(EG.Model.detectInstance(a))return a.get("id");throw new Error("When creating records, relationships must be either records or IDs.")});else if(EG.Model.detectInstance(j))j=j.get("id");else if("string"!==Em.typeOf(j)&&null!==j)throw new Error("When creating records, relationships must be either records or IDs.");var k=this._relationshipsForName(h).filter(function(a){var c=a.get("state");if(c===e){var h=a.otherId(this);return i.kind===b?new Em.Set(j).contains(h)&&(g||f._changeRelationshipState(a.get("id"),d)):j===h&&(g||f._changeRelationshipState(a.get("id"),d)),!1}return c===d?(f._deleteRelationship(a.get("id")),!1):!0},this);if(i.kind===b){var l=new Em.Set(j);k.forEach(function(a){l.contains(a.otherId(this))&&f._changeRelationshipState(a.get("id"),d)},this);var m=this._hasManyValue(h),n=(m.without(l),l.without(m));n.forEach(function(a){var b=d,j=this._hasOneConflict(h,a);if(null!==j)switch(j.get("state")){case e:case d:f._deleteRelationship(j.get("id"));break;case c:g?b=e:f._deleteRelationship(j.get("id"))}f._createRelationship(this.typeKey,h,this.get("id"),i.relatedType,i.inverse,a,b)},this)}else{var o=this._hasOneConflict(h,j);if(1===k.length)if(k[0].otherId(this)===j)f._changeRelationshipState(k[0].get("id"),d);else if(g){if(null!==j){if(null!==o)switch(o.get("state")){case e:case d:f._deleteRelationship(o.get("id"));break;case c:}f._createRelationship(this.typeKey,h,this.get("id"),i.relatedType,i.inverse,j,e)}}else f._deleteRelationship(k[0].get("id")),null!==j&&(null!==o&&f._deleteRelationship(o.get("id")),f._createRelationship(this.typeKey,h,this.get("id"),i.relatedType,i.inverse,j,d));else 0===k.length&&null!==j&&(null!==o&&f._deleteRelationship(o.get("id")),f._createRelationship(this.typeKey,h,this.get("id"),i.relatedType,i.inverse,j,d))}},this)},_hasOneConflict:function(b,e){if(null===e)return null;var f=this.constructor.metaForRelationship(b);if(null===f.inverse)return null;var g=this.get("store").modelForType(f.relatedType),h=g.metaForRelationship(f.inverse);if(h.kind!==a)return null;var i=this.get("store").getRecord(f.relatedType,e);if(i){var j=i._hasOneValue(f.inverse);return null===j||j===this.get("id")?null:i._findLinkTo(f.inverse,j)}var k=this.get("store")._relationshipsForRecord(f.relatedType,f.inverse,e);return 0===k.length?null:(k=k.filter(function(a){var b=a.get("state");return b===d||b===c}),k.length>0?k[0]:null)},changedRelationships:function(){var a={};return this.constructor.eachRelationship(function(c,d){var e,f;d.kind===b?(e=this._hasManyValue(c,!0),f=this._hasManyValue(c,!1),e.isEqual(f)||(a[c]=[e,f])):(e=this._hasOneValue(c,!0),f=this._hasOneValue(c,!1),e!==f&&(a[c]=[e,f]))},this),a},rollbackRelationships:function(){var a=this.get("store");this._getAllRelationships().forEach(function(b){switch(b.get("state")){case c:a._deleteRelationship(b.get("id"));break;case d:break;case e:a._changeRelationshipState(b.get("id"),d)}},this)},addToRelationship:function(a,b){EG.Model.detectInstance(b)&&(b=b.get("id"));var f=this.get("store"),g=this.constructor.metaForRelationship(a);if(!g.readOnly){var h=this._findLinkTo(a,b);if(!h||h.get("state")!==c&&h.get("state")!==d){if(h&&h.get("state")===e)return void this.get("store")._changeRelationshipState(h.get("id"),d);var i=this._hasOneConflict(a,b);if(null!==i)switch(i.get("state")){case e:break;case d:f._changeRelationshipState(i.get("id"),e);break;case c:f._deleteRelationship(i.get("id"))}f._createRelationship(this.typeKey,a,this.get("id"),g.relatedType,g.inverse,b,c)}}},removeFromRelationship:function(a,b){EG.Model.detectInstance(b)&&(b=b.get("id"));var f=this.constructor.metaForRelationship(a);if(!f.readOnly){var g=this._findLinkTo(a,b);if(null!==g)switch(g.get("state")){case c:this.get("store")._deleteRelationship(g.get("id"));break;case d:this.get("store")._changeRelationshipState(g.get("id"),e);break;case e:}}},setHasOneRelationship:function(a,b){EG.Model.detectInstance(b)&&(b=b.get("id"));var f=this.constructor.metaForRelationship(a);if(!f.readOnly){var g=this._findLinkTo(a,b);if(!g||g.get("state")!==c&&g.get("state")!==d){if(g&&g.get("state")===e)return void this.get("store")._changeRelationshipState(g.get("id"),d);if(null!==b){if(null===b)return void this.clearHasOneRelationship(a);this.clearHasOneRelationship(a,!0);var h=this.get("store"),i=this._hasOneConflict(a,b);if(null!==i)switch(i.get("state")){case e:break;case d:h._changeRelationshipState(i.get("id"),e);break;case c:h._deleteRelationship(i.get("id"))}h._createRelationship(this.typeKey,a,this.get("id"),f.relatedType,f.inverse,b,c)}}}},clearHasOneRelationship:function(a){var b=this.constructor.metaForRelationship(a);if(!b.readOnly){var f=this._hasOneValue(a);if(null!==f){var g=this._findLinkTo(a,f);if(null!==g)switch(g.get("state")){case c:this.get("store")._deleteRelationship(g.get("id"));break;case d:this.get("store")._changeRelationshipState(g.get("id"),e);break;case e:}}}},_findLinkTo:function(a,b){for(var c=this._getAllRelationships(),d=0;d<c.length;d+=1)if(c[d].relationshipName(this)===a&&c[d].otherId(this)===b)return c[d];return null},_isLinkedTo:function(a,b){return null!==this._findLinkTo(a,b)},_relationshipsForName:function(a){var b=this._getAllRelationships();return b.filter(function(b){return b.relationshipName(this)===a},this)},_connectRelationship:function(a){var b=EG.Relationship.stateToHash(a.get("state"));this.set(b+"."+a.get("id"),a),this.notifyPropertyChange(b)},_disconnectRelationship:function(a){var b=EG.Relationship.stateToHash(a.get("state"));delete this.get(b)[a.get("id")],this.notifyPropertyChange(b)}})}(),function(){EG.attr=function(a){return{isAttribute:!0,options:a}},EG.hasMany=function(a){return{isRelationship:!0,kind:EG.Model.HAS_MANY_KEY,options:a}},EG.hasOne=function(a){return{isRelationship:!0,kind:EG.Model.HAS_ONE_KEY,options:a}}}();