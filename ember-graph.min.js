(function(){window.EmberGraph=window.EG=Em.Namespace.create({VERSION:"0.1.0"}),Ember.libraries&&Ember.libraries.register("Ember Graph",EG.VERSION)})(),function(){Em&&Em.onLoad("Ember.Application",function(a){a.initializer({name:"injectStore",before:"store",initialize:function(a,b){b.inject("controller","store","store:main"),b.inject("route","store","store:main"),b.inject("adapter","store","store:main"),b.inject("serializer","store","store:main")}}),a.initializer({name:"store",initialize:function(a,b){b.register("store:main",b.Store||EG.Store,{singleton:!0}),b.register("adapter:rest",EG.RESTAdapter,{singleton:!0}),b.register("adapter:fixture",EG.FixtureAdapter,{singleton:!0}),b.register("adapter:localStorage",EG.LocalStorageAdapter,{singleton:!0}),b.register("serializer:json",EG.JSONSerializer,{singleton:!0}),b.register("type:string",EG.StringType,{singleton:!0}),b.register("type:number",EG.NumberType,{singleton:!0}),b.register("type:boolean",EG.BooleanType,{singleton:!0}),b.register("type:date",EG.DateType,{singleton:!0}),b.register("type:object",EG.ObjectType,{singleton:!0}),b.register("type:array",EG.ArrayType,{singleton:!0});var c=a.lookup("store:main");b.set("store",c)}})})}(),function(){EG.util={generateGUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})},values:function(a){return Em.keys(a).map(function(b){return a[b]})}}}(),function(){Em.Set.reopen({withoutAll:function(a){var b=this.copy();return b.removeObjects(a),b}})}(),function(){EG.String={startsWith:function(a,b){return 0===a.indexOf(b)},endsWith:function(a,b){return a.indexOf(b,a.length-b.length)>=0},capitalize:function(a){return a[0].toLocaleUpperCase()+a.substring(1)},decapitalize:function(a){return a[0].toLocaleLowerCase()+a.substring(1)}},(Em.EXTEND_PROTOTYPES===!0||Em.EXTEND_PROTOTYPES.String)&&(String.prototype.startsWith=String.prototype.startsWith||function(a){return EG.String.startsWith(this,a)},String.prototype.endsWith=String.prototype.endsWith||function(a){return EG.String.endsWith(this,a)},String.prototype.capitalize=String.prototype.capitalize||function(){return EG.String.capitalize(this)},String.prototype.decapitalize=String.prototype.decapitalize||function(){return EG.String.decapitalize(this)})}(),function(){var a=["equipment","information","rice","money","species","series","fish","sheep","moose","deer","news"],b=[[/(m)an$/gi,"$1en"],[/(pe)rson$/gi,"$1ople"],[/(child)$/gi,"$1ren"],[/^(ox)$/gi,"$1en"],[/(ax|test)is$/gi,"$1es"],[/(octop|vir)us$/gi,"$1i"],[/(alias|status)$/gi,"$1es"],[/(bu)s$/gi,"$1ses"],[/(buffal|tomat|potat)o$/gi,"$1oes"],[/([ti])um$/gi,"$1a"],[/sis$/gi,"ses"],[/(?:([^f])fe|([lr])f)$/gi,"$1$2ves"],[/(hive)$/gi,"$1s"],[/([^aeiouy]|qu)y$/gi,"$1ies"],[/(x|ch|ss|sh)$/gi,"$1es"],[/(matr|vert|ind)ix|ex$/gi,"$1ices"],[/([m|l])ouse$/gi,"$1ice"],[/(quiz)$/gi,"$1zes"],[/s$/gi,"s"],[/$/gi,"s"]],c=[[/(m)en$/gi,"$1an"],[/(pe)ople$/gi,"$1rson"],[/(child)ren$/gi,"$1"],[/([ti])a$/gi,"$1um"],[/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/gi,"$1$2sis"],[/(hive)s$/gi,"$1"],[/(tive)s$/gi,"$1"],[/(curve)s$/gi,"$1"],[/([lr])ves$/gi,"$1f"],[/([^fo])ves$/gi,"$1fe"],[/([^aeiouy]|qu)ies$/gi,"$1y"],[/(s)eries$/gi,"$1eries"],[/(m)ovies$/gi,"$1ovie"],[/(x|ch|ss|sh)es$/gi,"$1"],[/([m|l])ice$/gi,"$1ouse"],[/(bus)es$/gi,"$1"],[/(o)es$/gi,"$1"],[/(shoe)s$/gi,"$1"],[/(cris|ax|test)es$/gi,"$1is"],[/(octop|vir)i$/gi,"$1us"],[/(alias|status)es$/gi,"$1"],[/^(ox)en/gi,"$1"],[/(vert|ind)ices$/gi,"$1ex"],[/(matr)ices$/gi,"$1ix"],[/(quiz)zes$/gi,"$1"],[/s$/gi,""]],d=function(b,c){if(a.indexOf(b)>=0)return b;for(var d=0;d<c.length;d+=1)if(b.match(c[d][0]))return b.replace(c[d][0],c[d][1]);return b};EG.String.pluralize=function(a){return d(a,b)},EG.String.singularize=function(a){return d(a,c)},(Em.EXTEND_PROTOTYPES===!0||Em.EXTEND_PROTOTYPES.String)&&(String.prototype.pluralize=String.prototype.pluralize||function(){return EG.String.pluralize(this)},String.prototype.singularize=String.prototype.singularize||function(){return EG.String.singularize(this)})}(),function(){var a=function(a){return new Error("Your serializer failed to implement the '"+a+"' method.")};EG.Serializer=Em.Object.extend({store:null,serialize:function(){throw a("serialize")},deserialize:function(){throw a("deserialize")}})}(),function(){EG.JSONSerializer=EG.Serializer.extend({serialize:function(a,b){b=b||{};var c={};return b.includeId&&(c.id=a.get("id")),a.constructor.eachAttribute(function(b,d){var e=this.get("store").attributeTypeFor(d.type);c[b]=e.serialize(a.get(b))},this),Em.get(a.constructor,"relationships").length>0&&(c.links={}),a.constructor.eachRelationship(function(b,d){var e=a.get("_"+b);c.links[b]=d.kind===EG.Model.HAS_MANY_KEY?e.filter(function(a){return!EG.Model.isTemporaryId(a)}):null===e||EG.Model.isTemporaryId(e)?null:e}),c},deserialize:function(a,b){if(!a||0===Em.keys(a).length)return{};var c=new Em.Set(Em.keys(a)),d=this._extract(a);return d.meta=d.meta||{},b&&b.isQuery&&(d.meta.queryIds=a[c.withoutAll(["meta","linked"]).toArray()[0]].map(function(a){return""+a.id})),b&&b.isCreatedRecord&&(d.meta.newId=a[c.withoutAll(["meta","linked"]).toArray()[0]][0].id+""),Em.keys(d).forEach(function(a){"meta"!==a&&(d[a]=d[a].map(function(b){return this._deserializeSingle(a,b)},this).filter(function(a){return!!a}))},this),d},_extract:function(a){var b=a.hasOwnProperty("linked")?this._extract(a.linked):{};return Em.keys(a).forEach(function(c){if("linked"!==c&&"meta"!==c){var d=EG.String.singularize(c);b[d]=a[c].concat(b[d]||[])}},this),b},_deserializeSingle:function(a,b){try{if(b=b||{},b.links=b.links||{},"string"!==Em.typeOf(b.id)&&"number"!==Em.typeOf(b.id))return null;var c=this.get("store").modelForType(a),d={id:b.id+""};return this._validateAttributes(c,b),Em.keys(b).forEach(function(a){if("id"!==a&&"links"!==a){var e=c.metaForAttribute(a),f=this.get("store").attributeTypeFor(e.type);d[a]=f.deserialize(b[a])}},this),this._validateRelationships(c,b),Em.keys(b.links).forEach(function(a){var e=c.metaForRelationship(a);e.kind===EG.Model.HAS_MANY_KEY?d[a]=b.links[a].map(function(a){return""+a}):(d[a]=b.links[a],null!==d[a]&&(d[a]=""+d[a]))}),d}catch(e){return null}},_validateAttributes:function(a,b){var c=Em.get(a,"attributes"),d=new Em.Set(Em.keys(b));d.removeObjects(["id","links"]);d.withoutAll(c);a.eachAttribute(function(a,c){if(!b.hasOwnProperty(a)&&c.isRequired)throw new Error("Your JSON is missing the required `"+a+"` attribute.")})},_validateRelationships:function(a,b){{var c=Em.get(a,"relationships"),d=new Em.Set(Em.keys(b.links));d.withoutAll(c)}a.eachRelationship(function(a,c){if(!b.links.hasOwnProperty(a)&&c.isRequired)throw new Error("Your JSON is missing the required `"+a+"` relationship.");if(b.links.hasOwnProperty(a)){var d=Em.typeOf(b.links[a]);if(c.kind===EG.Model.HAS_MANY_KEY){if("array"!==d)throw new Error("The `"+a+"` has many relationship in your JSON was not an array.")}else if("string"!==d&&"number"!==d&&"null"!==d)throw new Error("The `"+a+"` has one relationship in your JSON was not a valid value (string, number or null).")}})}})}(),function(){var a=function(a){return new Error("Your adapter failed to implement the '"+a+"' method.")};EG.Adapter=Em.Object.extend({store:null,defaultSerializer:"json",serializer:Em.computed(function(){var a=this.get("container"),b=a.lookup("serializer:application")||a.lookup("serializer:"+this.get("defaultSerializer"));return b}).property().readOnly(),createRecord:function(){throw a("createRecord")},findRecord:function(){throw a("findRecord")},findMany:function(){throw a("findMany")},findAll:function(){throw a("findAll")},findQuery:function(){throw a("findQuery")},updateRecord:function(){throw a("updateRecord")},deleteRecord:function(){throw a("deleteRecord")},serialize:function(a,b){return this.get("serializer").serialize(a,b)},deserialize:function(a,b){return this.get("serializer").deserialize(a,b)}})}(),function(){var a=function(a){return!Em.isEmpty(a)};EG.SynchronousAdapter=EG.Adapter.extend({_getRecord:Em.required(),_getRecords:Em.required(),_setRecord:Em.required(),_deleteRecord:Em.required(),createRecord:function(a){return a.set("id",EG.util.generateGUID()),this._setRecord(a),Em.RSVP.Promise.resolve({})},findRecord:function(b,c){var d={};return d[EG.String.pluralize(b)]=[this._getRecord(b,c)].filter(a),Em.RSVP.Promise.resolve(this.deserialize(d))},findMany:function(b,c){var d={};return d[EG.String.pluralize(b)]=c.map(function(a){return this._getRecord(b,a)},this).filter(a),Em.RSVP.Promise.resolve(this.deserialize(d))},findAll:function(a){var b={};return b[EG.String.pluralize(a)]=this._getRecords(a),Em.RSVP.Promise.resolve(this.deserialize(b))},findQuery:function(){throw new Error("Your adapter doesn't implement `findQuery`.")},updateRecord:function(a){return this._setRecord(a),Em.RSVP.Promise.resolve({})},deleteRecord:function(a){return this._deleteRecord(a.typeKey,a.get("id")),Em.RSVP.Promise.resolve({})}})}(),function(){EG.FixtureAdapter=EG.SynchronousAdapter.extend({_getRecord:function(a,b){var c=this.get("store").modelForType(a);c.FIXTURES=c.FIXTURES||[];for(var d=0;d<c.FIXTURES.length;d+=1)if(c.FIXTURES[d].id===b)return this._fixtureToJson(a,c.FIXTURES[d]);return null},_getRecords:function(a){return(this.get("store").modelForType(a).FIXTURES||[]).map(function(b){return this._fixtureToJson(a,b)},this)},_setRecord:function(a){var b=this._recordToFixture(a),c=a.constructor;c.FIXTURES=c.FIXTURES||[];for(var d=0;d<c.FIXTURES.length;d+=1)if(c.FIXTURES[d].id===b.id)return void(c.FIXTURES[d]=b);c.FIXTURES.push(b)},_deleteRecord:function(a,b){var c=this.get("store").modelForType(a);c.FIXTURES=c.FIXTURES||[];for(var d=0;d<c.FIXTURES.length;d+=1)if(c.FIXTURES[d].id===b)return void c.FIXTURES.splice(d,1)},_fixtureToJson:function(a,b){var c=this.get("store").modelForType(a),d={id:b.id,links:{}};return c.eachAttribute(function(a,c){var e=this.get("store").attributeTypeFor(c.type);d[a]=void 0===b[a]?c.defaultValue:e.serialize(b[a])},this),c.eachRelationship(function(a,c){var e=b[a];d.links[a]=c.kind===EG.Model.HAS_MANY_KEY?void 0===e?c.defaultValue:e.filter(function(a){return!EG.Model.isTemporaryId(a)}):void 0===e?c.defaultValue:e}),d},_recordToFixture:function(a){var b={id:a.get("id")};return a.constructor.eachAttribute(function(c){b[c]=a.get(c)}),a.constructor.eachRelationship(function(c){b[c]=a.get("_"+c),b[c]&&b[c].toArray&&(b[c]=b[c].toArray())}),b}})}(),function(){EG.LocalStorageAdapter=EG.SynchronousAdapter.extend({fixtures:[],init:function(){if(!JSON.parse(localStorage["ember-graph.models.initialized"]||"false")){var a=this.get("store"),b=EG.FixtureAdapter.create({store:a});this.get("fixtures").forEach(function(c){(a.modelForType(c).FIXTURES||[]).forEach(function(a){var d=a.id,e=JSON.stringify(b._getRecord(c,d));localStorage["ember-graph.models."+c+"."+d]=e},this)},this)}return localStorage["ember-graph.models.initialized"]="true",this._super()},_getRecord:function(a,b){var c=localStorage["ember-graph.models."+a+"."+b];return"string"===Em.typeOf(c)?JSON.parse(c):null},_getRecords:function(a){return Em.keys(localStorage).filter(function(b){return EG.String.startsWith(b,"ember-graph.models."+a)}).map(function(a){var b=/ember-graph\.models\.(.+)\.(.+)/g.exec(a);return this._getRecord(b[1],b[2])},this)},_setRecord:function(a){var b=this.serialize(a,{includeId:!0});localStorage["ember-graph.models."+a.typeKey+"."+b.id]=JSON.stringify(b)},_deleteRecord:function(a,b){delete localStorage["ember-graph.models."+a+"."+b]}})}(),function(){EG.RESTAdapter=EG.Adapter.extend({createRecord:function(a){var b=this._buildUrl(a.typeKey,null),c=this.serialize(a,{includeId:!1});return this._ajax(b,"POST",{},c).then(function(a){return this.deserialize(a,{isCreatedRecord:!0})}.bind(this))},findRecord:function(a,b){var c=this._buildUrl(a,b);return this._ajax(c,"GET").then(function(a){return this.deserialize(a)}.bind(this))},findMany:function(a,b){var c=this._buildUrl(a,b.join(","));return this._ajax(c,"GET").then(function(a){return this.deserialize(a)}.bind(this))},findAll:function(a){var b=this._buildUrl(a,null);return this._ajax(b,"GET").then(function(a){return this.deserialize(a)}.bind(this))},findQuery:function(a,b){var c={};Em.keys(b).forEach(function(a){c[a]=""+b[a]});var d=this._buildUrl(a,null,c);return this._ajax(d,"GET").then(function(a){return this.deserialize(a,{isQuery:!0})}.bind(this))},updateRecord:function(a){var b=this._buildUrl(a.typeKey,a.get("id")),c=this.serialize(a,{includeId:!0});return this._ajax(b,"PUT",{},c).then(function(a){return this.deserialize(a)}.bind(this))},deleteRecord:function(a){var b=this._buildUrl(a.typeKey,a.get("id"));return this._ajax(b,"DELETE").then(function(a){return this.deserialize(a)||{}}.bind(this))},_buildUrl:function(a,b,c){var d=this.get("prefix")+"/";return d+=b?a+"/"+b:EG.String.pluralize(a),c&&Em.keys(c).forEach(function(a,b){d+=(0===b?"?":"&")+a+"="+encodeURIComponent(c[a])}),d},prefix:Em.computed(function(){return""}).property(),_ajax:function(a,b,c,d){return new Em.RSVP.Promise(function(e,f){$.ajax({cache:!1,contentType:"application/json",data:void 0===d?void 0:"string"===Em.typeOf(d)?d:JSON.stringify(d),headers:c||{},processData:!1,type:b,url:a,error:function(a,b,c){Em.run(null,f,c)},success:function(a){Em.run(null,e,a)}})})}})}(),function(){EG.Store=Em.Object.extend({defaultAdapter:"rest",cacheTimeout:1/0,_records:{},adapter:Em.computed(function(){var a=this.get("container"),b=a.lookup("adapter:application")||a.lookup("adapter:"+this.get("defaultAdapter"));return b}).property(),init:function(){this.set("_records",{}),this.set("_types",{}),this.set("_relationships",{}),this.set("_queuedRelationships",{})},_getRecord:function(a,b){var c=this.get("_records");return c[a]=c[a]||{},c[a][b]},_setRecord:function(a,b){var c=this.get("_records");c[a]=c[a]||{},c[a][b.get("id")]={record:b,timestamp:(new Date).getTime()}},_deleteRecord:function(a,b){var c=this.get("_records");c[a]=c[a]||{},delete c[a][b]},modelForType:function(a){this._modelCache=this._modelCache||{};var b=this.get("container").lookupFactory("model:"+a);return this._modelCache[a]||(this._modelCache[a]=b,b.reopen({typeKey:a}),b.reopenClass({typeKey:a})),b},createRecord:function(a,b){b=b||{};var c=this.modelForType(a)._create();return c.set("store",this),c.set("id",EG.Model.temporaryIdPrefix+EG.util.generateGUID()),this._setRecord(a,c),c.loadData(b),c},_loadRecord:function(a,b){var c=this.modelForType(a)._create();return c.set("store",this),c.set("id",b.id),this._setRecord(a,c),this._hasQueuedRelationships(a,b.id)&&this._connectQueuedRelationships(c),c.loadData(b),c},cachedRecordsFor:function(a){var b=this.get("_records."+a)||{},c=(new Date).getTime()-this.get("cacheTimeout");return Em.keys(b).map(function(a){var d=b[a];return d.timestamp>=c?d.record:void 0})},find:function(a,b){if(arguments.length>1&&!b)throw new Ember.Error("A bad `find` call was made to the store.");switch(Em.typeOf(b)){case"string":case"number":return this._findSingle(a,b+"");case"array":return this._findMany(a,b);case"object":return this._findQuery(a,b);case"undefined":return this._findAll(a);default:throw new Ember.Error("A bad `find` call was made to the store.")}},getRecord:function(a,b){var c=this._getRecord(a,b),d=(new Date).getTime()-this.get("cacheTimeout");return c&&c.record?c.timestamp>=d?c.record:null:null},_findSingle:function(a,b){var c,d=this.getRecord(a,b);return c=d?Em.RSVP.Promise.resolve(d):this.get("adapter").findRecord(a,b).then(function(c){return this.extractPayload(c),this.getRecord(a,b)}.bind(this)),EG.ModelPromiseObject.create({id:b,promise:c})},_findMany:function(a,b){b=b||[];var c=new Em.Set(b);b.forEach(function(b){null!==this.getRecord(a,b)&&c.removeObject(b)},this);var d;return d=0===c.length?Em.RSVP.Promise.resolve(b.map(function(b){return this.getRecord(a,b)},this)):this.get("adapter").findMany(a,c.toArray()).then(function(c){return this.extractPayload(c),b.map(function(b){return this.getRecord(a,b)},this).toArray()}.bind(this)),EG.PromiseArray.create({promise:d})},_findAll:function(a){var b=this.get("adapter").findAll(a).then(function(b){return this.extractPayload(b),this.cachedRecordsFor(a)}.bind(this));return EG.PromiseArray.create({promise:b})},_findQuery:function(a,b){var c=this.get("adapter").findQuery(a,b).then(function(b){var c=b.meta.ids;return this.extractPayload(b),c.map(function(b){return this.getRecord(a,b)},this)}.bind(this));return EG.PromiseArray.create({promise:c})},hasRecord:function(a,b){return null!==this.getRecord(a,b)},saveRecord:function(a){var b=a.typeKey,c=a.get("isNew"),d=a.get("id");return a.set("isSaving",!0),c?this.get("adapter").createRecord(a).then(function(c){return a.set("id",c.meta.newId),a.set("isSaving",!1),this._deleteRecord(b,d),this._setRecord(b,a),this.extractPayload(c),a}.bind(this)):this.get("adapter").updateRecord(a).then(function(b){return this.extractPayload(b),a.set("isSaving",!1),a}.bind(this))},deleteRecord:function(a){{var b=a.typeKey,c=a.get("id");this.get("_records."+b)||{}}return a.set("isSaving",!0),a.set("isDeleted",!0),this.get("adapter").deleteRecord(a).then(function(d){this._deleteRelationshipsForRecord(b,c),this.extractPayload(d),a.set("isSaving",!1),this._deleteRecord(b,c)}.bind(this))},reloadRecord:function(a){return a.set("isReloading",!0),this.get("adapter").find(a.typeKey,a.get("id")).then(function(b){return this.extractPayload(b),a.set("isReloading",!1),a}.bind(this))},extractPayload:function(a){Em.changeProperties(function(){var b=this.get("reloadDirty");Em.keys(a).forEach(function(c){if("meta"!==c){{this.modelForType(c)}a[c].forEach(function(a){var d=this.getRecord(c,a.id);d?(!d.get("isDirty")||b)&&d.loadData(a):this._loadRecord(c,a)},this)}},this)},this)},attributeTypeFor:function(a){var b=this.get("container").lookup("type:"+a);return b}})}(),function(){EG.Store.reopen({reloadDirty:!0,sideWithClientOnConflict:!0,overwriteClientAttributes:!1,_relationships:{},_queuedRelationships:null,_hasQueuedRelationships:function(a,b){for(var c=EG.util.values(this.get("_queuedRelationships")),d=0;d<c.length;d+=1)if(c[d].get("type2")===a&&c[d].get("object2")===b)return!0;return!1},_connectQueuedRelationships:function(a){var b=this.get("_queuedRelationships"),c=this._queuedRelationshipsFor(a.typeKey,a.get("id"));c.forEach(function(c){a._connectRelationship(c),c.set("object2",a),delete b[c.get("id")]}),this.notifyPropertyChange("_queuedRelationships")},_queuedRelationshipsFor:function(a,b){var c,d=[],e=this.get("_queuedRelationships");for(var f in e)e.hasOwnProperty(f)&&(c=e[f],c.get("type2")===a&&c.get("object2")===b&&d.push(c));return d},_createRelationship:function(a,b,c,d,e,f,g){var h=this.getRecord(a,c),i=this.getRecord(d,f);if(null!==h||null!==i){if(null===h){var j=h;h=i,i=j,j=c,c=f,f=c,j=b,b=e,e=j}if(null!==b&&!h._isLinkedTo(b,f)){var k=EG.Relationship.create({object1:h,relationship1:b,object2:null===i?f:i,relationship2:e,state:g});this.get("_relationships")[k.get("id")]=k,h._connectRelationship(k),null!==i?i._connectRelationship(k):(this.set("_queuedRelationships."+k.get("id"),k),this.notifyPropertyChange("_queuedRelationships"))}}},_deleteRelationship:function(a){var b=this.get("_relationships")[a];if(!Em.isNone(b)){var c=b.get("object1"),d=b.get("object2");c._disconnectRelationship(b),EG.Model.detectInstance(d)?d._disconnectRelationship(b):(delete this.get("_queuedRelationships")[a],this.notifyPropertyChange("_queuedRelationships")),delete this.get("_relationships")[a]}},_changeRelationshipState:function(a,b){var c=this.get("_relationships")[a];if(!Em.isNone(c)&&c.get("state")!==b){var d=c.get("object1"),e=c.get("object2"),f=EG.Relationship.stateToHash(c.get("state")),g=EG.Relationship.stateToHash(b);c.set("state",b),d.set(g+"."+a,d.get(f+"."+a)),delete d.get(f)[a],d.notifyPropertyChange(f),d.notifyPropertyChange(g),EG.Model.detectInstance(e)&&(e.set(g+"."+a,e.get(f+"."+a)),delete e.get(f)[a],e.notifyPropertyChange(f),e.notifyPropertyChange(g))}},_relationshipsForRecord:function(a,b,c){return EG.util.values(this.get("_relationships")).filter(function(d){if(d.get("type1")===a&&d.get("id")===c&&d.get("relationship1")===b)return!0;if(d.get("type2")===a&&d.get("relationship2")===b){var e=d.get("object2");if("string"===Em.typeOf(e)){if(e===c)return!0}else if(e.get("id")===c)return!0}return!1})},_deleteRelationshipsForRecord:function(a,b){var c,d=this.get("_relationships");for(var e in d)d.hasOwnProperty(e)&&(c=d[e],c.isConnectedTo(a,b)&&this._deleteRelationship(Em.get(c,"id")))}})}(),function(){EG.PromiseObject=Em.ObjectProxy.extend(Em.PromiseProxyMixin),EG.PromiseArray=Em.ArrayProxy.extend(Em.PromiseProxyMixin),EG.ModelPromiseObject=EG.PromiseObject.extend({__modelId:null,id:function(a,b){var c=this.get("content");return arguments.length>1&&(c&&c.set?c.set("id",b):this.set("__modelId",b)),c&&c.get?c.get("id"):this.get("__modelId")}.property("__modelId","content.id")}),EG.ModelPromiseArray=EG.PromiseArray.extend({ids:function(a,b){this.set("content",(b||[]).map(function(a){return{id:a}}))}.property()})}(),function(){var a="new",b="saved",c="deleted";EG.Relationship=Em.Object.extend({id:null,state:function(){var d=a;return function(e,f){if(arguments.length>1){if(f!==a&&f!==b&&f!==c)throw new Error("'"+f+"' is an invalid relationship state.");d=f}return d}}(),object1:null,relationship1:null,type1:null,object2:null,relationship2:null,type2:null,oneWay:Em.computed(function(){return null===this.get("relationship2")}).property("relationship2"),init:function(){this.set("id",Em.generateGuid(null,"relationship"))},isNew:function(){return this.get("state")===a},isSaved:function(){return this.get("state")===b},isDeleted:function(){return this.get("state")===c},otherId:function(a){if(this.get("object1")===a){var b=this.get("object2");return"string"===Em.typeOf(b)?b:b.get("id")}return this.get("object1.id")},otherRecord:function(a){var b=this.get("object1");if(b===a){var c=this.get("object2");if("string"===Em.typeOf(c)){var d=b.constructor.metaForRelationship(this.get("relationship1")).relatedType;return b.get("store").getRecord(d,c)}return c}return b},relationshipName:function(a){return this.get("object1")===a?this.get("relationship1"):this.get("object2")===a?this.get("relationship2"):void 0},isConnectedTo:function(a,b){if(this.get("type1")===a&&this.get("object1.id")===b)return!0;if(this.get("type2")===a){var c=this.get("object2");return"string"===Em.typeOf(c)?c===b:Em.get(c,"id")===b}return!1}}),EG.Relationship.reopenClass({NEW_STATE:a,SAVED_STATE:b,DELETED_STATE:c,create:function(a){var b=this._super();return b.setProperties(a),b.set("type1",a.object1.typeKey),EG.Model.detectInstance(a.object2)?b.set("type2",a.object2.typeKey):b.set("type2",a.object1.constructor.metaForRelationship(a.relationship1).relatedType),b},stateToHash:function(d){switch(d){case a:return"_clientRelationships";case b:return"_serverRelationships";case c:return"_deletedRelationships";default:return""}}})}(),function(){EG.AttributeType=Em.Object.extend({defaultValue:null,serialize:function(a){return a},deserialize:function(a){return a},isValid:function(){return!0},isEqual:function(a,b){return a===b}})}(),function(){EG.ArrayType=EG.AttributeType.extend({serialize:function(a){return Em.isNone(a)?null:(a=a.toArray?a.toArray():a,Em.isArray(a)?a:null)},deserialize:function(a){return Em.isArray(a)?a:null},isValid:function(a){try{return JSON.stringify(a),Em.isArray(a)}catch(b){return!1}},isEqual:function(a,b){return Em.isArray(a)&&Em.isArray(b)?0===Em.compare(a.toArray(),b.toArray()):!1}})}(),function(){EG.BooleanType=EG.AttributeType.extend({defaultValue:!1,serialize:function(a){return this._coerceToBoolean(a)},deserialize:function(a){return this._coerceToBoolean(a)},_coerceToBoolean:function(a){return"boolean"===Em.typeOf(a)&&1==a?!0:"string"===Em.typeOf(a)&&"true"==a?!0:!1},isValid:function(a){return"boolean"===Em.typeOf(a)}})}(),function(){EG.DateType=EG.AttributeType.extend({serialize:function(a){switch(Em.typeOf(a)){case"date":return a.getTime();case"number":return a;case"string":return new Date(a).getTime();default:return null}},deserialize:function(a){switch(Em.typeOf(a)){case"number":case"string":return new Date(a);default:return null}},isValid:function(a){return null===a||"date"===Em.typeOf(a)},isEqual:function(a,b){var c=null===a,d=null===b;return c&&d?!0:c&&!d||!c&&d?!1:new Date(a).getTime()===new Date(b).getTime()}})}(),function(){EG.EnumType=EG.AttributeType.extend({defaultValue:Em.computed(function(){throw new Error("You must override the `defaultValue` in an enumeration type.")}).property(),values:[],_valuesSet:Em.computed(function(){return new Em.Set(this.get("values").map(function(a){return a.toLocaleLowerCase()}))}).property(),_isValidValue:function(a){return this.get("_valuesSet").contains(a.toLowerCase())},serialize:function(a){return a+="",this._isValidValue(a)?a:this.get("defaultValue")},deserialize:Em.aliasMethod("serialize"),isValid:function(a){return this._isValidValue(a+"")},isEqual:function(a,b){return"string"!==Em.typeOf(a)||"string"!==Em.typeOf(b)?!1:(a+"").toLocaleLowerCase()===(b+"").toLocaleLowerCase()}})}(),function(){EG.NumberType=EG.AttributeType.extend({defaultValue:0,serialize:function(a){return this._coerceToNumber(a)},deserialize:function(a){return this._coerceToNumber(a)},_coerceToNumber:function(a){if(this.isValid(a))return Number(a);if("string"===Em.typeOf(a)){var b=Number(a);if(this.isValid(b))return b}return 0},isValid:function(a){return"number"===Em.typeOf(a)&&!isNaN(a)&&isFinite(a)}})}(),function(){var a=function(a){return!Em.isNone(a)&&"object"===Em.typeOf(a)&&a.constructor===Object},b=function(c,d){if(a(c)&&a(d)){if(!new Em.Set(Em.keys(c)).isEqual(new Em.Set(Em.keys(d))))return!1;for(var e=Em.keys(c),f=0;f<e.length;f+=1)if(!b(c[e[f]],d[e[f]]))return!1;return!0}return Em.isArray(c)&&Em.isArray(d)?0===Em.compare(c,d):c===d};EG.ObjectType=EG.AttributeType.extend({serialize:function(b){if(!a(b))return null;try{return JSON.stringify(b),b}catch(c){return null}},deserialize:function(b){return a(b)?b:null},isValid:function(b){try{return JSON.stringify(b),a(b)}catch(c){return!1}},isEqual:function(c,d){return a(c)&&a(d)?b(c,d):!1}})}(),function(){EG.StringType=EG.AttributeType.extend({serialize:function(a){return null===a?null:""+a},deserialize:function(a){return null===a?null:""+a},isValid:function(a){return null===a||"string"===Em.typeOf(a)}})}(),function(){EG.Model=Em.Object.extend(Em.Evented,{typeKey:null,_id:null,id:Em.computed(function(a,b){var c=this.get("_id");if(arguments.length>1){var d=this.constructor.temporaryIdPrefix;if(null===c)return this.set("_id",b),b;if(EG.String.startsWith(c,d)&&!EG.String.startsWith(b,d))return this.set("_id",b),b;throw new Error("Cannot change the 'id' property of a model.")}return c}).property("_id"),store:null,isDeleted:null,isSaving:null,isReloading:null,isLoaded:Em.computed(function(){return null!==this.get("store")}).property("store"),isDirty:Em.computed(function(){var a=this.get("isDeleted"),b=this.get("isSaving");if(a&&!b)return!1;var c=a&&b;return this.get("_areAttributesDirty")||this.get("_areRelationshipsDirty")||c}).property("_areAttributesDirty","_areRelationshipsDirty","isDeleted","isSaving"),isNew:Em.computed(function(){return EG.String.startsWith(this.get("_id"),this.constructor.temporaryIdPrefix)}).property("_id"),_initializeProperties:function(){this.set("_id",null),this.set("store",null),this.set("isDeleted",!1),this.set("isSaving",!1),this.set("isReloading",!1)}.on("init"),loadData:function(a){a=a||{},this._loadAttributes(a),this._loadRelationships(a)},save:function(){return this.get("store").saveRecord(this)},reload:function(){return this.get("store").reloadRecord(this)},destroy:function(){return this.get("store").deleteRecord(this)},isEqual:function(a){return a?this.typeKey===Em.get(a,"typeKey")&&this.get("id")===Em.get(a,"id"):void 0},rollback:function(){this.rollbackAttributes(),this.rollbackRelationships()}}),EG.Model.reopenClass({temporaryIdPrefix:"EG_TEMP_ID_",isTemporaryId:function(a){return EG.String.startsWith(a,this.temporaryIdPrefix)},create:function(){},_create:EG.Model.create,extend:function(){var a=Array.prototype.slice.call(arguments,0),b=a.pop()||{},c={},d={};b instanceof Em.Mixin||Em.keys(b).forEach(function(a){var e=b[a];b[a]&&(b[a].isRelationship?(d[a]=e,delete b[a]):b[a].isAttribute&&(c[a]=e,delete b[a]))}),a.push(b);var e=this._super.apply(this,a);return e._declareAttributes(c),e._declareRelationships(d),e},isEqual:function(a,b){return Em.isNone(a)||Em.isNone(b)?!1:this.detectInstance(a)?a.isEqual(b):this.detectInstance(b)?b.isEqual(a):this.detectInstance(Em.get(a,"content"))?Em.get(a,"content").isEqual(b):this.detectInstance(Em.get(b,"content"))?Em.get(b,"content").isEqual(a):!1}})}(),function(){var a=(new Em.Set(["id","type","content"]),function(a,b){var c={isAttribute:!0,type:b.type,isRequired:!b.hasOwnProperty("defaultValue"),defaultValue:b.defaultValue,readOnly:b.readOnly===!0,isEqual:b.isEqual,isValid:b.isValid},d=Em.computed(function(a,b){var c=this.constructor.metaForAttribute(a),d=this.get("_serverAttributes."+a),e=this.get("_clientAttributes."+a),f=void 0===e?d:e;if(void 0!==b){var g=c.isValid||this.get("store").attributeTypeFor(c.type).isValid;if(!g(b))return f;var h=c.isEqual||this.get("store").attributeTypeFor(c.type).isEqual;return h(d,b)?this.set("_clientAttributes."+a,void 0):this.set("_clientAttributes."+a,b),this.notifyPropertyChange("_clientAttributes"),b}return f}).property("_clientAttributes."+a,"_serverAttributes."+a).meta(c);return b.readOnly?d.readOnly():d});EG.Model.reopenClass({_declareAttributes:function(b){var c={};Em.keys(b).forEach(function(d){c[d]=a(d,b[d].options)}),this.reopen(c)},attributes:Em.computed(function(){var a=new Em.Set;return this.eachComputedProperty(function(b,c){c.isAttribute&&a.addObject(b)}),a}).property(),metaForAttribute:Em.aliasMethod("metaForProperty"),isAttribute:function(a){return Em.get(this,"attributes").contains(a)},eachAttribute:function(a,b){this.eachComputedProperty(function(c,d){d.isAttribute&&a.call(b,c,d)})}}),EG.Model.reopen({_serverAttributes:null,_clientAttributes:null,_initializeAttributes:function(){this.set("_serverAttributes",Em.Object.create()),this.set("_clientAttributes",Em.Object.create())}.on("init"),_areAttributesDirty:Em.computed(function(){return Em.keys(this.get("_clientAttributes")||{}).length>0}).property("_clientAttributes"),changedAttributes:function(){var a={},b=this.get("store");return this.constructor.eachAttribute(function(c,d){var e=this.get("_serverAttributes."+c),f=this.get("_clientAttributes."+c),g=b.attributeTypeFor(d.type),h=d.isEqual||g.isEqual;void 0===f||h(e,f)||(a[c]=[e,f])},this),a},rollbackAttributes:function(){this.set("_clientAttributes",Em.Object.create())},_loadAttributes:function(a){this.constructor.eachAttribute(function(b,c){var d=a.hasOwnProperty(b)?a[b]:c.defaultValue,e=c.isValid||this.get("store").attributeTypeFor(c.type).isValid;e(d)?this.set("_serverAttributes."+b,d):this.set("_serverAttributes."+b,c.defaultValue)},this)}})}(),function(){var a=EG.Model.HAS_ONE_KEY="hasOne",b=EG.Model.HAS_MANY_KEY="hasMany",c=EG.Relationship.NEW_STATE,d=EG.Relationship.SAVED_STATE,e=EG.Relationship.DELETED_STATE,f=(new Em.Set(["id","type","content"]),function(a,c,d){var e={isRelationship:!1,kind:c,isRequired:d.hasOwnProperty("defaultValue")?!1:d.isRequired!==!1,defaultValue:d.defaultValue||(c===b?[]:null),relatedType:d.relatedType,inverse:d.inverse,readOnly:d.readOnly===!0};return c===b?Em.computed(function(a){return this._hasManyValue(a.substring(1))}).property("_serverRelationships."+a,"_clientRelationships."+a).meta(e).readOnly():Em.computed(function(a){return this._hasOneValue(a.substring(1))}).property("_serverRelationships."+a,"_clientRelationships."+a).meta(e).readOnly()});EG.Model.reopenClass({_declareRelationships:function(a){var c={};Em.keys(a).forEach(function(d){var e,g=a[d].kind,h=a[d].options,i=h.relatedType;e=g===b?function(){return this.get("store").find(i,this.get("_"+d).toArray())
}:function(){var a=this.get("_"+d);return null===a?null:this.get("store").find(i,a)},c["_"+d]=f(d,g,h);var j=Em.copy(c["_"+d].meta(),!0);j.isRelationship=!0,c[d]=Em.computed(e).property("_"+d).meta(j).readOnly()}),this.reopen(c)},relationships:Em.computed(function(){var a=new Em.Set;return this.eachComputedProperty(function(b,c){c.isRelationship&&a.addObject(b)}),a}).property(),isRelationship:function(a){return Em.get(this,"relationships").contains(a)},metaForRelationship:Em.aliasMethod("metaForProperty"),relationshipKind:function(a){return this.metaForRelationship(a).kind},eachRelationship:function(a,b){this.eachComputedProperty(function(c,d){d.isRelationship&&a.call(b,c,d)})}}),EG.Model.reopen({_serverRelationships:null,_deletedRelationships:null,_clientRelationships:null,_initializeRelationships:function(){this.set("_serverRelationships",Em.Object.create()),this.set("_clientRelationships",Em.Object.create()),this.set("_deletedRelationships",Em.Object.create())}.on("init"),_hasOneValue:function(a,b){for(var c=EG.util.values(this.get("_serverRelationships")),d=EG.util.values(this.get((b?"_deleted":"_client")+"Relationships")),e=c.concat(d),f=0;f<e.length;f+=1)if(e[f].relationshipName(this)===a)return e[f].otherId(this);return null},_hasManyValue:function(a,b){for(var c=EG.util.values(this.get("_serverRelationships")),d=EG.util.values(this.get((b?"_deleted":"_client")+"Relationships")),e=c.concat(d),f=[],g=0;g<e.length;g+=1)e[g].relationshipName(this)===a&&f.push(e[g].otherId(this));return new Em.Set(f)},_areRelationshipsDirty:Em.computed(function(){var a=Em.keys(this.get("_clientRelationships")).length>0,b=Em.keys(this.get("_deletedRelationships")).length>0;return a||b}).property("_clientRelationships","_deletedRelationships"),_getAllRelationships:function(){var a=EG.util.values(this.get("_serverRelationships")),b=EG.util.values(this.get("_clientRelationships")),c=EG.util.values(this.get("_deletedRelationships"));return a.concat(b.concat(c))},_loadRelationships:function(a){var f=this.get("store"),g=f.get("sideWithClientOnConflict");this.constructor.eachRelationship(function(h,i){if(i.isRequired&&!a.hasOwnProperty(h))throw new Error("You left out the required '"+h+"' relationship.");var j=a[h]||i.defaultValue;if(i.kind===b)j=j.map(function(a){if("string"===Em.typeOf(a))return a;if(EG.Model.detectInstance(a))return a.get("id");throw new Error("When creating records, relationships must be either records or IDs.")});else if(EG.Model.detectInstance(j))j=j.get("id");else if("string"!==Em.typeOf(j)&&null!==j)throw new Error("When creating records, relationships must be either records or IDs.");var k=this._relationshipsForName(h).filter(function(a){var c=a.get("state");if(c===e){var h=a.otherId(this);return i.kind===b?new Em.Set(j).contains(h)&&(g||f._changeRelationshipState(a.get("id"),d)):j===h&&(g||f._changeRelationshipState(a.get("id"),d)),!1}return c===d?(f._deleteRelationship(a.get("id")),!1):!0},this);if(i.kind===b){var l=new Em.Set(j);k.forEach(function(a){l.contains(a.otherId(this))&&f._changeRelationshipState(a.get("id"),d)},this);var m=this._hasManyValue(h),n=(m.without(l),l.without(m));n.forEach(function(a){var b=d,j=this._hasOneConflict(h,a);if(null!==j)switch(j.get("state")){case e:case d:f._deleteRelationship(j.get("id"));break;case c:g?b=e:f._deleteRelationship(j.get("id"))}f._createRelationship(this.typeKey,h,this.get("id"),i.relatedType,i.inverse,a,b)},this)}else{var o=this._hasOneConflict(h,j);if(1===k.length)if(k[0].otherId(this)===j)f._changeRelationshipState(k[0].get("id"),d);else if(g){if(null!==j){if(null!==o)switch(o.get("state")){case e:case d:f._deleteRelationship(o.get("id"));break;case c:}f._createRelationship(this.typeKey,h,this.get("id"),i.relatedType,i.inverse,j,e)}}else f._deleteRelationship(k[0].get("id")),null!==j&&(null!==o&&f._deleteRelationship(o.get("id")),f._createRelationship(this.typeKey,h,this.get("id"),i.relatedType,i.inverse,j,d));else 0===k.length&&null!==j&&(null!==o&&f._deleteRelationship(o.get("id")),f._createRelationship(this.typeKey,h,this.get("id"),i.relatedType,i.inverse,j,d))}},this)},_hasOneConflict:function(b,e){if(null===e)return null;var f=this.constructor.metaForRelationship(b);if(null===f.inverse)return null;var g=this.get("store").modelForType(f.relatedType),h=g.metaForRelationship(f.inverse);if(h.kind!==a)return null;var i=this.get("store").getRecord(f.relatedType,e);if(i){var j=i._hasOneValue(f.inverse);return null===j||j===this.get("id")?null:i._findLinkTo(f.inverse,j)}var k=this.get("store")._relationshipsForRecord(f.relatedType,f.inverse,e);return 0===k.length?null:(k=k.filter(function(a){var b=a.get("state");return b===d||b===c}),k.length>0?k[0]:null)},changedRelationships:function(){var a={};return this.constructor.eachRelationship(function(c,d){var e,f;d.kind===b?(e=this._hasManyValue(c,!0),f=this._hasManyValue(c,!1),e.isEqual(f)||(a[c]=[e,f])):(e=this._hasOneValue(c,!0),f=this._hasOneValue(c,!1),e!==f&&(a[c]=[e,f]))},this),a},rollbackRelationships:function(){var a=this.get("store");this._getAllRelationships().forEach(function(b){switch(b.get("state")){case c:a._deleteRelationship(b.get("id"));break;case d:break;case e:a._changeRelationshipState(b.get("id"),d)}},this)},addToRelationship:function(a,b){EG.Model.detectInstance(b)&&(b=b.get("id"));var f=this.get("store"),g=this.constructor.metaForRelationship(a);if(!g.readOnly){var h=this._findLinkTo(a,b);if(!h||h.get("state")!==c&&h.get("state")!==d){if(h&&h.get("state")===e)return void this.get("store")._changeRelationshipState(h.get("id"),d);var i=this._hasOneConflict(a,b);if(null!==i)switch(i.get("state")){case e:break;case d:f._changeRelationshipState(i.get("id"),e);break;case c:f._deleteRelationship(i.get("id"))}f._createRelationship(this.typeKey,a,this.get("id"),g.relatedType,g.inverse,b,c)}}},removeFromRelationship:function(a,b){EG.Model.detectInstance(b)&&(b=b.get("id"));var f=this.constructor.metaForRelationship(a);if(!f.readOnly){var g=this._findLinkTo(a,b);if(null!==g)switch(g.get("state")){case c:this.get("store")._deleteRelationship(g.get("id"));break;case d:this.get("store")._changeRelationshipState(g.get("id"),e);break;case e:}}},setHasOneRelationship:function(a,b){EG.Model.detectInstance(b)&&(b=b.get("id"));var f=this.constructor.metaForRelationship(a);if(!f.readOnly){var g=this._findLinkTo(a,b);if(!g||g.get("state")!==c&&g.get("state")!==d){if(g&&g.get("state")===e)return void this.get("store")._changeRelationshipState(g.get("id"),d);if(null!==b){if(null===b)return void this.clearHasOneRelationship(a);this.clearHasOneRelationship(a,!0);var h=this.get("store"),i=this._hasOneConflict(a,b);if(null!==i)switch(i.get("state")){case e:break;case d:h._changeRelationshipState(i.get("id"),e);break;case c:h._deleteRelationship(i.get("id"))}h._createRelationship(this.typeKey,a,this.get("id"),f.relatedType,f.inverse,b,c)}}}},clearHasOneRelationship:function(a){var b=this.constructor.metaForRelationship(a);if(!b.readOnly){var f=this._hasOneValue(a);if(null!==f){var g=this._findLinkTo(a,f);if(null!==g)switch(g.get("state")){case c:this.get("store")._deleteRelationship(g.get("id"));break;case d:this.get("store")._changeRelationshipState(g.get("id"),e);break;case e:}}}},_findLinkTo:function(a,b){for(var c=this._getAllRelationships(),d=0;d<c.length;d+=1)if(c[d].relationshipName(this)===a&&c[d].otherId(this)===b)return c[d];return null},_isLinkedTo:function(a,b){return null!==this._findLinkTo(a,b)},_relationshipsForName:function(a){var b=this._getAllRelationships();return b.filter(function(b){return b.relationshipName(this)===a},this)},_connectRelationship:function(a){var b=EG.Relationship.stateToHash(a.get("state"));this.set(b+"."+a.get("id"),a),this.notifyPropertyChange(b)},_disconnectRelationship:function(a){var b=EG.Relationship.stateToHash(a.get("state"));delete this.get(b)[a.get("id")],this.notifyPropertyChange(b)}})}(),function(){EG.attr=function(a){return{isAttribute:!0,options:a}},EG.hasMany=function(a){return{isRelationship:!0,kind:EG.Model.HAS_MANY_KEY,options:a}},EG.hasOne=function(a){return{isRelationship:!0,kind:EG.Model.HAS_ONE_KEY,options:a}}}();